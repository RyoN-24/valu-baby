<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargando... ‚Äî VAL√ö Baby</title>
    <meta name="description"
        content="Pieza exclusiva de la colecci√≥n VAL√ö Baby. Confeccionada con los tejidos m√°s delicados para sus primeros momentos.">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/cart.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå∏</text></svg>">
    <style>
        /* Product page specific styles */
        .product-page {
            padding: 2rem 0 4rem;
            min-height: 60vh;
        }

        .product-page__inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-md);
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        @media (min-width: 768px) {
            .product-page__inner {
                grid-template-columns: 1fr 1fr;
                gap: 3rem;
            }
        }

        .product-gallery__main img {
            width: 100%;
            border-radius: 12px;
            aspect-ratio: 1/1;
            object-fit: cover;
        }

        .product-gallery__thumbs {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .product-gallery__thumb {
            width: 72px;
            height: 72px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s ease;
            background-size: cover;
            background-position: center;
        }

        .product-gallery__thumb.active,
        .product-gallery__thumb:hover {
            border-color: var(--blush-deep);
        }

        .product-details__eyebrow {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--mid-gray);
            margin-bottom: 0.5rem;
        }

        .product-details__name {
            font-size: clamp(1.6rem, 4vw, 2.2rem);
            font-weight: 500;
            letter-spacing: -0.01em;
            margin-bottom: 0.75rem;
        }

        .product-details__price {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--blush-deep);
            margin-bottom: 1rem;
        }

        .product-details__stock {
            display: inline-block;
            padding: 0.4rem 1rem;
            background: var(--blush-pale);
            color: var(--blush-deep);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
        }

        .product-details__description {
            font-size: 0.95rem;
            color: var(--dark);
            line-height: 1.7;
            margin-bottom: 1.5rem;
            max-width: 100%;
        }

        .size-selector {
            margin-bottom: 1.5rem;
        }

        .size-selector__label {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
            display: block;
        }

        .size-selector__options {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .size-selector__btn {
            padding: 0.65rem 1.2rem;
            border: 1px solid var(--light-gray);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .size-selector__btn:hover {
            border-color: var(--blush-deep);
        }

        .size-selector__btn.selected {
            background: var(--near-black);
            color: white;
            border-color: var(--near-black);
        }

        .product-details__add-btn {
            width: 100%;
            margin-bottom: 2rem;
        }

        /* Loading state */
        .product-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50vh;
            gap: 1rem;
            grid-column: 1 / -1;
        }

        .product-loading__spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--off-white);
            border-top-color: var(--blush-deep);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .product-error {
            text-align: center;
            padding: 3rem;
            grid-column: 1 / -1;
        }

        .product-error h2 {
            margin-bottom: 1rem;
        }

        /* Product Info Accordion */
        .product-info {
            border-top: 1px solid var(--off-white);
        }

        .product-info__item {
            border-bottom: 1px solid var(--off-white);
        }

        .product-info__header {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 0;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--near-black);
        }

        .product-info__icon {
            width: 12px;
            height: 12px;
            position: relative;
        }

        .product-info__icon::before,
        .product-info__icon::after {
            content: '';
            position: absolute;
            background: var(--near-black);
            transition: transform 0.3s ease;
        }

        .product-info__icon::before {
            left: 0;
            top: 50%;
            width: 100%;
            height: 1px;
        }

        .product-info__icon::after {
            top: 0;
            left: 50%;
            width: 1px;
            height: 100%;
        }

        .product-info__item.open .product-info__icon::after {
            transform: rotate(90deg);
        }

        .product-info__body {
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.4s ease;
        }

        .product-info__item.open .product-info__body {
            max-height: 300px;
        }

        .product-info__body-inner {
            padding-bottom: 1.25rem;
        }

        .product-info__body-inner p {
            font-size: 0.9rem;
            color: var(--dark);
            line-height: 1.7;
            margin-bottom: 0.5rem;
            max-width: 100%;
        }
    </style>
</head>

<body>

    <!-- ========== Navigation ========== -->
    <nav class="nav scrolled" id="navbar">
        <div class="nav__inner">
            <a href="index.html" class="nav__brand">
                VAL√ö
                <span>Baby</span>
            </a>
            <ul class="nav__links" id="navLinks">
                <li><a href="index.html" class="nav__link">Home</a></li>
                <li><a href="catalog.html" class="nav__link">Cat√°logo</a></li>
                <li><a href="about.html" class="nav__link">Our Story</a></li>
                <li><a href="faq.html" class="nav__link">FAQ</a></li>
            </ul>
            <button class="cart-toggle" id="cartToggle" aria-label="Shopping Cart">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <path d="M16 10a4 4 0 0 1-8 0"></path>
                </svg>
                <span class="cart-badge" id="cartBadge">0</span>
            </button>
            <button class="nav__toggle" id="navToggle" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- ========== Product Page ========== -->
    <section class="product-page">
        <div class="product-page__inner" id="productContainer">
            <!-- Loading State -->
            <div class="product-loading" id="productLoading">
                <div class="product-loading__spinner"></div>
                <p style="color: var(--mid-gray); font-size: 0.9rem;">Cargando producto...</p>
            </div>
        </div>
    </section>

    <!-- ========== Footer ========== -->
    <footer class="footer">
        <div class="footer__inner">
            <div class="footer__col">
                <p class="footer__brand">
                    VAL√ö
                    <span>Baby</span>
                </p>
                <p style="font-size: 0.82rem; color: var(--mid-gray); max-width: 250px; margin-top: 0.5rem;">
                    Curated pieces for her most delicate moments.
                </p>
            </div>
            <div class="footer__col">
                <h4>Navigate</h4>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="catalog.html">Cat√°logo</a></li>
                    <li><a href="about.html">Our Story</a></li>
                    <li><a href="faq.html">FAQ</a></li>
                </ul>
            </div>
            <div class="footer__col">
                <h4>Connect</h4>
                <ul>
                    <li><a href="https://instagram.com" target="_blank" rel="noopener">Instagram</a></li>
                    <li><a href="https://wa.me/51901440221" target="_blank" rel="noopener">WhatsApp</a></li>
                    <li><a href="mailto:hello@valubaby.com">hello@valubaby.com</a></li>
                </ul>
            </div>
            <div class="footer__col">
                <h4>Legal</h4>
                <ul>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                    <li><a href="#">Exchange Policy</a></li>
                </ul>
            </div>
        </div>
        <div class="footer__bottom">
            <p>&copy; 2026 VAL√ö Baby. All rights reserved.</p>
            <p>Made with care.</p>
        </div>
    </footer>

    <!-- ========== Cart Sidebar ========== -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-sidebar__header">
            <h2>Tu Carrito</h2>
            <button class="cart-close" id="cartClose" aria-label="Cerrar carrito">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="cart-sidebar__body">
            <div id="emptyCart" class="cart-empty">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <path d="M16 10a4 4 0 0 1-8 0"></path>
                </svg>
                <p>Tu carrito est√° vac√≠o</p>
                <a href="catalog.html" class="btn btn--primary">Ver Cat√°logo</a>
            </div>
            <div id="cartItems" class="cart-items"></div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Subtotal:</span>
                <span id="cartSubtotal">S/ 0.00</span>
            </div>
            <button class="btn btn--primary btn--full" id="checkoutBtn">
                Proceder al Pago
            </button>
            <p class="cart-shipping-note">Env√≠o calculado en el checkout</p>
        </div>
    </div>
    <div class="cart-overlay" id="cartOverlay"></div>

    <!-- WhatsApp Floating Button -->
    <a href="https://wa.me/51901440221?text=Hola%2C%20me%20interesa%20la%20colecci%C3%B3n%20VAL√ö%20Baby"
        class="whatsapp-float" target="_blank" rel="noopener noreferrer" aria-label="Contactar por WhatsApp">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.652a11.963 11.963 0 005.713 1.456h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"
                fill="currentColor" />
        </svg>
    </a>

    <div class="cart-notification" id="cartNotification"></div>

    <script src="js/main.js"></script>
    <script src="js/api.js"></script>
    <script src="js/cart.js"></script>
    <script>
        /* ============================================
           Dynamic Product Page
           Loads product from API based on URL ?id=
           ============================================ */

        class ProductPage {
            constructor() {
                this.product = null;
                this.selectedSize = null;
                this.currentImageIndex = 0;
                this.init();
            }

            async init() {
                const params = new URLSearchParams(window.location.search);
                const productId = params.get('id');

                if (!productId) {
                    this.showError('No se especific√≥ un producto.');
                    return;
                }

                await this.loadProductWithRetry(productId);
            }

            async loadProductWithRetry(productId, maxRetries = 3) {
                for (let attempt = 1; attempt <= maxRetries; attempt++) {
                    try {
                        console.log(`Loading product (attempt ${attempt}/${maxRetries})...`);
                        await this.loadProduct(productId);
                        return;
                    } catch (error) {
                        console.warn(`Attempt ${attempt} failed:`, error.message);
                        if (attempt < maxRetries) {
                            await new Promise(resolve => setTimeout(resolve, 5000));
                        }
                    }
                }
                this.showError('No se pudo cargar el producto. Por favor intenta de nuevo.');
            }

            async loadProduct(productId) {
                const response = await window.api.getProduct(productId);

                if (response.success && response.data) {
                    this.product = response.data;
                    this.renderProduct();
                } else {
                    throw new Error('Product not found');
                }
            }

            renderProduct() {
                const container = document.getElementById('productContainer');
                const p = this.product;

                // Update page title
                document.title = `${p.name} ‚Äî VAL√ö Baby`;

                // Update meta description
                const metaDesc = document.querySelector('meta[name="description"]');
                if (metaDesc && p.description) {
                    metaDesc.content = p.description;
                }

                // Build images array (use all available images)
                const images = p.images && p.images.length > 0
                    ? p.images
                    : ['https://images.unsplash.com/photo-1519689373023-dd07c7988603?w=800&q=85'];

                // Build sizes array
                const sizes = p.sizes && p.sizes.length > 0
                    ? p.sizes
                    : ['0-3M', '3-6M', '6-12M', '12-18M', '18-24M'];

                container.innerHTML = `
                    <!-- Gallery -->
                    <div class="product-gallery reveal">
                        <div class="product-gallery__main" id="mainImage">
                            <img src="${images[0]}" alt="${p.name}">
                        </div>
                        ${images.length > 1 ? `
                        <div class="product-gallery__thumbs">
                            ${images.map((img, i) => `
                                <div class="product-gallery__thumb ${i === 0 ? 'active' : ''}"
                                     data-index="${i}"
                                     style="background-image: url('${img}'); background-size: cover; background-position: center;">
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                    </div>

                    <!-- Details -->
                    <div class="product-details reveal reveal-delay-1">
                        <p class="product-details__eyebrow">${p.category || 'VAL√ö Baby'}</p>
                        <h1 class="product-details__name">${p.name}</h1>
                        <p class="product-details__price">S/ ${parseFloat(p.price).toFixed(2)}</p>
                        ${p.stock !== undefined && p.stock <= 10
                        ? `<div class="product-details__stock">${p.stock <= 0 ? 'Agotado' : `Solo quedan ${p.stock} unidades`}</div>`
                        : '<div class="product-details__stock">Unidades Limitadas</div>'
                    }

                        ${p.description ? `<p class="product-details__description">${p.description}</p>` : ''}

                        <!-- Size Selector -->
                        <div class="size-selector">
                            <label class="size-selector__label">Selecciona tu talla</label>
                            <div class="size-selector__options">
                                ${sizes.map((size, i) => `
                                    <button class="size-selector__btn ${i === 0 ? 'selected' : ''}" data-size="${size}">${size}</button>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Add to Bag -->
                        <button class="btn btn--primary product-details__add-btn" id="addToBag" ${p.stock <= 0 ? 'disabled' : ''}>
                            ${p.stock <= 0 ? 'Agotado' : 'Agregar al Carrito'}
                        </button>

                        <!-- Product Info Accordion -->
                        <div class="product-info">
                            <div class="product-info__item open">
                                <button class="product-info__header" aria-expanded="true">
                                    Descripci√≥n
                                    <span class="product-info__icon"></span>
                                </button>
                                <div class="product-info__body">
                                    <div class="product-info__body-inner">
                                        <p>${p.description || 'Pieza cuidadosamente seleccionada de la colecci√≥n VAL√ö Baby. Dise√±ada para sus primeros momentos especiales.'}</p>
                                    </div>
                                </div>
                            </div>

                            <div class="product-info__item">
                                <button class="product-info__header" aria-expanded="false">
                                    Gu√≠a de Tallas
                                    <span class="product-info__icon"></span>
                                </button>
                                <div class="product-info__body">
                                    <div class="product-info__body-inner">
                                        <p><strong>0-3M:</strong> Hasta 62 cm / 5.5 kg</p>
                                        <p><strong>3-6M:</strong> 62‚Äì68 cm / 5.5‚Äì8 kg</p>
                                        <p><strong>6-12M:</strong> 68‚Äì76 cm / 8‚Äì10 kg</p>
                                        <p><strong>12-18M:</strong> 76‚Äì83 cm / 10‚Äì12 kg</p>
                                        <p><strong>18-24M:</strong> 83‚Äì90 cm / 12‚Äì14 kg</p>
                                    </div>
                                </div>
                            </div>

                            <div class="product-info__item">
                                <button class="product-info__header" aria-expanded="false">
                                    Pol√≠tica de Cambios
                                    <span class="product-info__icon"></span>
                                </button>
                                <div class="product-info__body">
                                    <div class="product-info__body-inner">
                                        <p>Aceptamos cambios dentro de los 7 d√≠as posteriores a la recepci√≥n del pedido. El
                                            producto debe estar en su empaque original, sin uso y con etiquetas. No realizamos
                                            devoluciones de dinero ‚Äî solo cambios por otra talla o pieza de igual valor.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Set initial selected size
                this.selectedSize = sizes[0];

                // Setup event listeners
                this.setupEventListeners();

                // Trigger reveal animations
                const reveals = container.querySelectorAll('.reveal');
                reveals.forEach((el, i) => {
                    setTimeout(() => el.classList.add('visible'), i * 150);
                });
            }

            setupEventListeners() {
                // Size selector
                const sizeButtons = document.querySelectorAll('.size-selector__btn');
                sizeButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        sizeButtons.forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        this.selectedSize = btn.dataset.size;
                    });
                });

                // Add to Bag
                const addBtn = document.getElementById('addToBag');
                if (addBtn) {
                    addBtn.addEventListener('click', () => {
                        if (!this.selectedSize) {
                            alert('Por favor selecciona una talla');
                            return;
                        }

                        const p = this.product;
                        const product = {
                            id: p.id,
                            name: p.name,
                            price: parseFloat(p.price),
                            size: this.selectedSize,
                            image: p.images && p.images[0] ? p.images[0] : '',
                            quantity: 1
                        };

                        if (window.cart) {
                            window.cart.addItem(product);
                        }
                    });
                }

                // Image gallery thumbnails
                const thumbs = document.querySelectorAll('.product-gallery__thumb');
                const mainImg = document.querySelector('#mainImage img');
                const images = this.product.images || [];

                thumbs.forEach(thumb => {
                    thumb.addEventListener('click', () => {
                        const idx = parseInt(thumb.dataset.index);
                        if (images[idx] && mainImg) {
                            mainImg.src = images[idx];
                            thumbs.forEach(t => t.classList.remove('active'));
                            thumb.classList.add('active');
                        }
                    });
                });

                // Accordion
                const accordionHeaders = document.querySelectorAll('.product-info__header');
                accordionHeaders.forEach(header => {
                    header.addEventListener('click', () => {
                        const item = header.parentElement;
                        const isOpen = item.classList.contains('open');
                        item.classList.toggle('open');
                        header.setAttribute('aria-expanded', !isOpen);
                    });
                });
            }

            showError(message) {
                const container = document.getElementById('productContainer');
                container.innerHTML = `
                    <div class="product-error">
                        <h2>Producto no encontrado</h2>
                        <p style="color: var(--mid-gray); margin-bottom: 1.5rem;">${message}</p>
                        <a href="catalog.html" class="btn btn--primary">Ver Cat√°logo</a>
                    </div>
                `;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            new ProductPage();
        });
    </script>
</body>

</html>